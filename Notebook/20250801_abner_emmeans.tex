% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{article}
\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math} % this also loads fontspec
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else
  % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage[margin=1in]{geometry}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\newsavebox\pandoc@box
\newcommand*\pandocbounded[1]{% scales image to fit in text height/width
  \sbox\pandoc@box{#1}%
  \Gscale@div\@tempa{\textheight}{\dimexpr\ht\pandoc@box+\dp\pandoc@box\relax}%
  \Gscale@div\@tempb{\linewidth}{\wd\pandoc@box}%
  \ifdim\@tempb\p@<\@tempa\p@\let\@tempa\@tempb\fi% select the smaller of both
  \ifdim\@tempa\p@<\p@\scalebox{\@tempa}{\usebox\pandoc@box}%
  \else\usebox{\pandoc@box}%
  \fi%
}
% Set default figure placement to htbp
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{-\maxdimen} % remove section numbering
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{colortbl}
\usepackage{pdflscape}
\usepackage{tabu}
\usepackage{threeparttable}
\usepackage{threeparttablex}
\usepackage[normalem]{ulem}
\usepackage{makecell}
\usepackage{xcolor}
\usepackage{bookmark}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same}
\hypersetup{
  pdftitle={20250801\_abner\_emmeans.Rmd},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}

\title{20250801\_abner\_emmeans.Rmd}
\author{}
\date{\vspace{-2.5em}2025-08-01}

\begin{document}
\maketitle

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# First, fit your model and store it}
\NormalTok{model }\OtherTok{\textless{}{-}} \FunctionTok{glm.nb}\NormalTok{(}
\NormalTok{    is.referenced.by.count }\SpecialCharTok{\textasciitilde{}}\NormalTok{ da\_factor }\SpecialCharTok{+} \FunctionTok{log}\NormalTok{(age.in.months) }\SpecialCharTok{+}\NormalTok{ container.title }\SpecialCharTok{+}
\NormalTok{        container.title}\SpecialCharTok{*}\NormalTok{da\_factor }\SpecialCharTok{+} \FunctionTok{log}\NormalTok{(age.in.months)}\SpecialCharTok{*}\NormalTok{da\_factor }\SpecialCharTok{+}
\NormalTok{        container.title}\SpecialCharTok{*}\FunctionTok{log}\NormalTok{(age.in.months) }\SpecialCharTok{+}
        \FunctionTok{log}\NormalTok{(age.in.months) }\SpecialCharTok{*}\NormalTok{ da\_factor }\SpecialCharTok{*}\NormalTok{ container.title,}
    \AttributeTok{data =}\NormalTok{ my\_data,}
    \AttributeTok{link =} \StringTok{"log"}
\NormalTok{)}
\CommentTok{\# Define the age values you want to examine (in months)}
\NormalTok{age\_values }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{12}\NormalTok{, }\DecValTok{36}\NormalTok{, }\DecValTok{60}\NormalTok{, }\DecValTok{120}\NormalTok{)  }\CommentTok{\# Adjust these as needed}
\CommentTok{\# Get emmeans on the link scale for all combinations}
\NormalTok{emm }\OtherTok{\textless{}{-}} \FunctionTok{emmeans}\NormalTok{(model,  }\SpecialCharTok{\textasciitilde{}}\NormalTok{ da\_factor }\SpecialCharTok{+}\NormalTok{ age.in.months }\SpecialCharTok{|}\NormalTok{ container.title,}
        \AttributeTok{at =} \FunctionTok{list}\NormalTok{(}\AttributeTok{age.in.months =}\NormalTok{ age\_values), }\AttributeTok{CIs =} \ConstantTok{TRUE}\NormalTok{,}
        \AttributeTok{type =} \StringTok{"response"}\NormalTok{)}
\CommentTok{\# Get pairwise comparisons (differences) between da\_factor levels}
\NormalTok{differences }\OtherTok{\textless{}{-}} \FunctionTok{contrast}\NormalTok{(}
\NormalTok{    emm, }\AttributeTok{by =} \FunctionTok{c}\NormalTok{(}\StringTok{"age.in.months"}\NormalTok{, }\StringTok{"container.title"}\NormalTok{),}
    \AttributeTok{method =} \StringTok{"pairwise"}\NormalTok{,}
    \AttributeTok{ratios =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{CIs =} \ConstantTok{TRUE}
\NormalTok{)}
\CommentTok{\# See the contrasts}
\FunctionTok{summary}\NormalTok{(differences)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## age.in.months = 12, container.title = Antimicrobial Agents and Chemotherapy:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  1.813 0.2050 Inf    1   5.265  <.0001
## 
## age.in.months = 36, container.title = Antimicrobial Agents and Chemotherapy:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  1.211 0.0755 Inf    1   3.069  0.0021
## 
## age.in.months = 60, container.title = Antimicrobial Agents and Chemotherapy:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  1.004 0.0451 Inf    1   0.081  0.9355
## 
## age.in.months = 120, container.title = Antimicrobial Agents and Chemotherapy:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.778 0.0330 Inf    1  -5.925  <.0001
## 
## age.in.months = 12, container.title = Applied and Environmental Microbiology:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  1.159 0.0797 Inf    1   2.150  0.0316
## 
## age.in.months = 36, container.title = Applied and Environmental Microbiology:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.933 0.0375 Inf    1  -1.727  0.0842
## 
## age.in.months = 60, container.title = Applied and Environmental Microbiology:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.843 0.0247 Inf    1  -5.826  <.0001
## 
## age.in.months = 120, container.title = Applied and Environmental Microbiology:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.735 0.0168 Inf    1 -13.440  <.0001
## 
## age.in.months = 12, container.title = Genome Announcements:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.888 0.6270 Inf    1  -0.169  0.8662
## 
## age.in.months = 36, container.title = Genome Announcements:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.912 0.3350 Inf    1  -0.251  0.8020
## 
## age.in.months = 60, container.title = Genome Announcements:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.924 0.1950 Inf    1  -0.376  0.7068
## 
## age.in.months = 120, container.title = Genome Announcements:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.939 0.0500 Inf    1  -1.175  0.2399
## 
## age.in.months = 12, container.title = Infection and Immunity:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  1.110 0.1940 Inf    1   0.599  0.5494
## 
## age.in.months = 36, container.title = Infection and Immunity:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.964 0.0999 Inf    1  -0.350  0.7267
## 
## age.in.months = 60, container.title = Infection and Immunity:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.903 0.0699 Inf    1  -1.315  0.1883
## 
## age.in.months = 120, container.title = Infection and Immunity:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.826 0.0527 Inf    1  -2.989  0.0028
## 
## age.in.months = 12, container.title = Journal of Bacteriology:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  1.083 0.1530 Inf    1   0.565  0.5719
## 
## age.in.months = 36, container.title = Journal of Bacteriology:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  1.131 0.0945 Inf    1   1.469  0.1419
## 
## age.in.months = 60, container.title = Journal of Bacteriology:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  1.153 0.0675 Inf    1   2.438  0.0147
## 
## age.in.months = 120, container.title = Journal of Bacteriology:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  1.185 0.0388 Inf    1   5.193  <.0001
## 
## age.in.months = 12, container.title = Journal of Clinical Microbiology:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  1.075 0.1430 Inf    1   0.549  0.5831
## 
## age.in.months = 36, container.title = Journal of Clinical Microbiology:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.812 0.0622 Inf    1  -2.721  0.0065
## 
## age.in.months = 60, container.title = Journal of Clinical Microbiology:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.712 0.0399 Inf    1  -6.058  <.0001
## 
## age.in.months = 120, container.title = Journal of Clinical Microbiology:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.597 0.0279 Inf    1 -11.064  <.0001
## 
## age.in.months = 12, container.title = Journal of Microbiology &amp; Biology Education:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes nonEst     NA  NA    1      NA      NA
## 
## age.in.months = 36, container.title = Journal of Microbiology &amp; Biology Education:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes nonEst     NA  NA    1      NA      NA
## 
## age.in.months = 60, container.title = Journal of Microbiology &amp; Biology Education:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes nonEst     NA  NA    1      NA      NA
## 
## age.in.months = 120, container.title = Journal of Microbiology &amp; Biology Education:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes nonEst     NA  NA    1      NA      NA
## 
## age.in.months = 12, container.title = Journal of Virology:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  1.253 0.1140 Inf    1   2.482  0.0131
## 
## age.in.months = 36, container.title = Journal of Virology:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  1.013 0.0513 Inf    1   0.255  0.7988
## 
## age.in.months = 60, container.title = Journal of Virology:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.918 0.0344 Inf    1  -2.291  0.0220
## 
## age.in.months = 120, container.title = Journal of Virology:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.802 0.0296 Inf    1  -5.974  <.0001
## 
## age.in.months = 12, container.title = mBio:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.976 0.0849 Inf    1  -0.278  0.7813
## 
## age.in.months = 36, container.title = mBio:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.825 0.0360 Inf    1  -4.411  <.0001
## 
## age.in.months = 60, container.title = mBio:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.763 0.0283 Inf    1  -7.311  <.0001
## 
## age.in.months = 120, container.title = mBio:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.686 0.0361 Inf    1  -7.161  <.0001
## 
## age.in.months = 12, container.title = Microbiology Resource Announcements:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  1.794 0.9710 Inf    1   1.080  0.2800
## 
## age.in.months = 36, container.title = Microbiology Resource Announcements:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  1.569 0.3480 Inf    1   2.033  0.0421
## 
## age.in.months = 60, container.title = Microbiology Resource Announcements:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  1.474 0.3000 Inf    1   1.910  0.0562
## 
## age.in.months = 120, container.title = Microbiology Resource Announcements:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  1.355 0.5030 Inf    1   0.818  0.4134
## 
## age.in.months = 12, container.title = Microbiology Spectrum:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.950 0.0733 Inf    1  -0.664  0.5064
## 
## age.in.months = 36, container.title = Microbiology Spectrum:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.751 0.0462 Inf    1  -4.657  <.0001
## 
## age.in.months = 60, container.title = Microbiology Spectrum:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.673 0.0702 Inf    1  -3.798  0.0001
## 
## age.in.months = 120, container.title = Microbiology Spectrum:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.580 0.0983 Inf    1  -3.214  0.0013
## 
## age.in.months = 12, container.title = mSphere:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.957 0.1510 Inf    1  -0.276  0.7823
## 
## age.in.months = 36, container.title = mSphere:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.882 0.0633 Inf    1  -1.753  0.0797
## 
## age.in.months = 60, container.title = mSphere:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.849 0.0559 Inf    1  -2.492  0.0127
## 
## age.in.months = 120, container.title = mSphere:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.806 0.0871 Inf    1  -1.998  0.0458
## 
## age.in.months = 12, container.title = mSystems:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  1.124 0.1690 Inf    1   0.773  0.4394
## 
## age.in.months = 36, container.title = mSystems:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.897 0.0686 Inf    1  -1.424  0.1546
## 
## age.in.months = 60, container.title = mSystems:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.807 0.0708 Inf    1  -2.439  0.0147
## 
## age.in.months = 120, container.title = mSystems:
##  contrast  ratio     SE  df null z.ratio p.value
##  No / Yes  0.700 0.0990 Inf    1  -2.519  0.0118
## 
## Tests are performed on the log scale
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Plot the contrasts}
\FunctionTok{plot}\NormalTok{(differences, }\AttributeTok{ratios =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 4 rows containing missing values or values outside the scale range
## (`geom_point()`).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 4 rows containing missing values or values outside the scale range
## (`geom_segment()`).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 4 rows containing missing values or values outside the scale range
## (`geom_point()`).
\end{verbatim}

\pandocbounded{\includegraphics[keepaspectratio]{20250801_abner_emmeans_files/figure-latex/unnamed-chunk-1-1.pdf}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# \# working on plotting better}
\CommentTok{\# emmip(model, \textasciitilde{} age.in.months | container.title, CIs = TRUE, type = "response",  at = list(age.in.months = age\_values)) +}
\CommentTok{\#     geom\_point(aes(x = age.in.months, y = is.referenced.by.count), data = my\_data, size = 1, color = "lightblue2", aes = 0.25 )}

\FunctionTok{emmip}\NormalTok{(differences, }\SpecialCharTok{\textasciitilde{}}\NormalTok{ age.in.months }\SpecialCharTok{|}\NormalTok{ container.title, }\AttributeTok{CIs =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{engine =} \StringTok{"ggplot"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## NOTE: Results may be misleading due to involvement in interactions
\end{verbatim}

\begin{verbatim}
## Warning: Removed 4 rows containing missing values or values outside the scale range
## (`geom_segment()`).
## Removed 4 rows containing missing values or values outside the scale range
## (`geom_point()`).
\end{verbatim}

\pandocbounded{\includegraphics[keepaspectratio]{20250801_abner_emmeans_files/figure-latex/unnamed-chunk-1-2.pdf}}

\subsection{The Other Plot from Abner}\label{the-other-plot-from-abner}

\begin{itemize}
\tightlist
\item
  Also, I think this result would be even clearer if you made a plot
  with ``age'' in the horizontal axis, ``predicted citations'' in the
  vertical axis, and lines colored by ``da\_factor''.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(DHARMa)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## This is DHARMa 0.4.7. For overview type '?DHARMa'. For recent changes, type news(package = 'DHARMa')
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(sjPlot)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## #refugeeswelcome
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\#smaller model with 2 terms}
\NormalTok{two\_term\_glmnb }\OtherTok{\textless{}{-}}\ControlFlowTok{function}\NormalTok{(model\_data, model\_name) \{}

\NormalTok{  total\_model }\OtherTok{\textless{}{-}}\NormalTok{MASS}\SpecialCharTok{::}\FunctionTok{glm.nb}\NormalTok{(is.referenced.by.count}\SpecialCharTok{\textasciitilde{}}\NormalTok{ da\_factor }\SpecialCharTok{+} \FunctionTok{log}\NormalTok{(age.in.months) }\SpecialCharTok{+} 
       \SpecialCharTok{+} \FunctionTok{log}\NormalTok{(age.in.months)}\SpecialCharTok{*}\NormalTok{da\_factor }\SpecialCharTok{+} \FunctionTok{log}\NormalTok{(age.in.months)}\SpecialCharTok{*}\NormalTok{da\_factor, }\AttributeTok{data =}\NormalTok{ model\_data, }\AttributeTok{link =}\NormalTok{ log)}

  \FunctionTok{return}\NormalTok{(total\_model)}
 
\NormalTok{\}}

\NormalTok{journals }\OtherTok{\textless{}{-}} 
\NormalTok{  nsd\_yes\_metadata }\SpecialCharTok{\%\textgreater{}\%}  
  \FunctionTok{count}\NormalTok{(journal\_abrev) }\SpecialCharTok{\%\textgreater{}\%}  
  \FunctionTok{filter}\NormalTok{(journal\_abrev }\SpecialCharTok{!=} \StringTok{"jmbe"}\NormalTok{) }

\NormalTok{j }\OtherTok{\textless{}{-}} \DecValTok{8} \CommentTok{\#mbio}


\NormalTok{  journal\_data }\OtherTok{\textless{}{-}} 
\NormalTok{  nsd\_yes\_metadata }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{filter}\NormalTok{(journal\_abrev }\SpecialCharTok{==}\NormalTok{ journals[[j,}\DecValTok{1}\NormalTok{]]) }\SpecialCharTok{\%\textgreater{}\%}  
    \FunctionTok{mutate}\NormalTok{(}\AttributeTok{da\_factor =} \FunctionTok{factor}\NormalTok{(da))}
  

\NormalTok{  model }\OtherTok{\textless{}{-}} \FunctionTok{two\_term\_glmnb}\NormalTok{(journal\_data, journals[[j,}\DecValTok{1}\NormalTok{]])}
\FunctionTok{summary}\NormalTok{(model)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## MASS::glm.nb(formula = is.referenced.by.count ~ da_factor + log(age.in.months) + 
##     +log(age.in.months) * da_factor + log(age.in.months) * da_factor, 
##     data = model_data, link = log, init.theta = 1.597744281)
## 
## Coefficients:
##                                 Estimate Std. Error z value Pr(>|z|)    
## (Intercept)                     -2.81124    0.15592 -18.030  < 2e-16 ***
## da_factorYes                    -0.35970    0.20003  -1.798  0.07215 .  
## log(age.in.months)               1.51608    0.03718  40.781  < 2e-16 ***
## da_factorYes:log(age.in.months)  0.15390    0.04860   3.166  0.00154 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for Negative Binomial(1.5977) family taken to be 1)
## 
##     Null deviance: 6961.8  on 2437  degrees of freedom
## Residual deviance: 2603.7  on 2434  degrees of freedom
##   (60 observations deleted due to missingness)
## AIC: 20128
## 
## Number of Fisher Scoring iterations: 1
## 
## 
##               Theta:  1.5977 
##           Std. Err.:  0.0482 
## 
##  2 x log-likelihood:  -20118.0870
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  plot\_model }\OtherTok{\textless{}{-}} \FunctionTok{plot\_model}\NormalTok{(model, }\AttributeTok{type =} \StringTok{"pred"}\NormalTok{, }\AttributeTok{terms =} \FunctionTok{c}\NormalTok{(}\StringTok{"da\_factor"}\NormalTok{, }\StringTok{"age.in.months[12,60,84,120,180]"}\NormalTok{)) }\SpecialCharTok{+}     \FunctionTok{ggtitle}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"Predicted counts of \textquotesingle{}is.referenced.by.count\textquotesingle{} }\SpecialCharTok{\textbackslash{}n}\StringTok{Plotted for journal "}\NormalTok{, journals[[j,}\DecValTok{1}\NormalTok{]]))}

 \FunctionTok{print}\NormalTok{(plot\_model)}
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{20250801_abner_emmeans_files/figure-latex/unnamed-chunk-2-1.pdf}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ model\_data }\OtherTok{\textless{}{-}} \FunctionTok{get\_model\_data}\NormalTok{(model, }\AttributeTok{type =} \StringTok{"pred"}\NormalTok{, }\AttributeTok{terms =} \FunctionTok{c}\NormalTok{(}\StringTok{"da\_factor"}\NormalTok{, }\StringTok{"age.in.months[12,60,84,120]"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}  
   \FunctionTok{tibble}\NormalTok{(}\AttributeTok{da\_factor =} \FunctionTok{ifelse}\NormalTok{(.}\SpecialCharTok{$}\NormalTok{x }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, }\StringTok{"Data not available"}\NormalTok{, }\StringTok{"Data available"}\NormalTok{), }\AttributeTok{predicted\_citations =}\NormalTok{ .}\SpecialCharTok{$}\NormalTok{predicted, }\AttributeTok{age.in.months =}\NormalTok{ .}\SpecialCharTok{$}\NormalTok{group)}
 
\NormalTok{kableExtra}\SpecialCharTok{::}\FunctionTok{kable}\NormalTok{(model\_data)}
\end{Highlighting}
\end{Shaded}

\begin{longtable}[]{@{}
  >{\raggedleft\arraybackslash}p{(\linewidth - 18\tabcolsep) * \real{0.0261}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 18\tabcolsep) * \real{0.0957}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 18\tabcolsep) * \real{0.0870}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 18\tabcolsep) * \real{0.0957}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 18\tabcolsep) * \real{0.0957}}
  >{\raggedright\arraybackslash}p{(\linewidth - 18\tabcolsep) * \real{0.0522}}
  >{\raggedright\arraybackslash}p{(\linewidth - 18\tabcolsep) * \real{0.0870}}
  >{\raggedright\arraybackslash}p{(\linewidth - 18\tabcolsep) * \real{0.1652}}
  >{\raggedleft\arraybackslash}p{(\linewidth - 18\tabcolsep) * \real{0.1739}}
  >{\raggedright\arraybackslash}p{(\linewidth - 18\tabcolsep) * \real{0.1217}}@{}}
\toprule\noalign{}
\begin{minipage}[b]{\linewidth}\raggedleft
x
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
predicted
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
std.error
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
conf.low
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
conf.high
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
group
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
group\_col
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
da\_factor
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedleft
predicted\_citations
\end{minipage} & \begin{minipage}[b]{\linewidth}\raggedright
age.in.months
\end{minipage} \\
\midrule\noalign{}
\endhead
\bottomrule\noalign{}
\endlastfoot
1 & 2.601432 & 0.0668792 & 2.281838 & 2.965789 & 12 & 12 & Data not
available & 2.601432 & 12 \\
1 & 29.847220 & 0.0270486 & 28.306105 & 31.472241 & 60 & 60 & Data not
available & 29.847220 & 60 \\
1 & 49.710146 & 0.0292298 & 46.942326 & 52.641164 & 84 & 84 & Data not
available & 49.710146 & 84 \\
1 & 85.366628 & 0.0364169 & 79.485880 & 91.682461 & 120 & 120 & Data not
available & 85.366628 & 120 \\
2 & 2.661219 & 0.0506662 & 2.409648 & 2.939056 & 12 & 12 & Data
available & 2.661219 & 12 \\
2 & 39.114855 & 0.0227761 & 37.407152 & 40.900517 & 60 & 60 & Data
available & 39.114855 & 60 \\
2 & 68.607500 & 0.0270623 & 65.063307 & 72.344756 & 84 & 84 & Data
available & 68.607500 & 84 \\
2 & 124.466847 & 0.0346578 & 116.292821 & 133.215412 & 120 & 120 & Data
available & 124.466847 & 120 \\
\end{longtable}

\begin{Shaded}
\begin{Highlighting}[]
 \FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ model\_data, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ age.in.months, }\AttributeTok{y =}\NormalTok{ predicted\_citations, }
                                \AttributeTok{color =}\NormalTok{ da\_factor)) }\SpecialCharTok{+} 
   \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
   \FunctionTok{geom\_crossbar}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{ymin =}\NormalTok{ conf.low,}
                    \AttributeTok{ymax =}\NormalTok{ conf.high)) }\SpecialCharTok{+}
   \CommentTok{\# geom\_linerange(aes(ymin = predicted\_citations {-} std.error, }
   \CommentTok{\#                  ymax = predicted\_citations + std.error)) + }
   \FunctionTok{geom\_path}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ age.in.months, }\AttributeTok{y =}\NormalTok{ predicted\_citations, }\AttributeTok{group =}\NormalTok{ da\_factor)) }\SpecialCharTok{+}
   \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Predicted number of citations for mBio over time using two term fixed GLM"}\NormalTok{,}
        \AttributeTok{subtitle =} \StringTok{"SE \textless{} 1 for all points and too small to be visualized"}\NormalTok{,  }
        \AttributeTok{x =} \StringTok{"Age in Months"}\NormalTok{, }
        \AttributeTok{y =} \StringTok{"Predicted Number of Citations"}\NormalTok{, }
        \AttributeTok{color =} \StringTok{"Data availability with 95\% CI"}\NormalTok{)  }
\end{Highlighting}
\end{Shaded}

\pandocbounded{\includegraphics[keepaspectratio]{20250801_abner_emmeans_files/figure-latex/unnamed-chunk-2-2.pdf}}

\end{document}
